---
import { getCollection } from "astro:content";
import Footer from "../components/Footer.astro";
import Link from "../components/Link.astro";
import BlogLayout from "../layouts/BlogLayout.astro";
import ProjectLayout from "../layouts/ProjectLayout.astro";

export async function getStaticPaths() {
    const posts = await getCollection("posts");
    const projects = await getCollection("projects");

    const postPaths = posts.map((post: any) => ({
        params: { slug: post.slug },
        props: { entry: post, type: "post" },
    }));

    const projectPaths = projects
        .filter((p: any) => !p.data.draft)
        .map((project: any) => ({
            params: { slug: project.slug },
            props: { entry: project, type: "project" },
        }));

    return [...postPaths, ...projectPaths];
}

const { entry, type } = Astro.props;
const { Content } = await entry.render();

// Simple reading time calculation
function calculateReadingTime(text: string) {
    const wordsPerMinute = 200;
    const words = text.trim().split(/\s+/).length;
    const minutes = Math.ceil(words / wordsPerMinute);
    return `${minutes} min read`;
}

const readingTime = type === "post" ? calculateReadingTime(entry.body) : null;
---

{
    type === "post" ? (
        <BlogLayout
            title={entry.data.title}
            description={entry.data.description}
            pubDate={entry.data.pubDate}
            lastUpdate={entry.data.lastUpdate}
            image={entry.data.image}
            slug={entry.slug}
            tags={entry.data.tags}
            readingTime={readingTime}
        >
            <Content components={{ a: Link }} />
            <Footer slot="footer" date={entry.data.pubDate} />
        </BlogLayout>
    ) : (
        <ProjectLayout
            title={entry.data.title}
            description={entry.data.description}
            pubDate={entry.data.pubDate}
            endDate={entry.data.endDate}
            ongoing={entry.data.ongoing}
            url={entry.data.url}
            slug={entry.slug}
        >
            <Content components={{ a: Link }} />
        </ProjectLayout>
    )
}
